# ContentAI 项目需求文档

## 项目概述
ContentAI 是一个简单的关键词搜索应用，允许用户输入关键词，调用 @news 服务进行搜索，并以 JSON 格式展示搜索结果。该应用提供一个简洁的用户界面，方便用户快速获取与关键词相关的新闻信息。

## 功能需求

### 1. 用户界面
- 提供简洁的首页界面
- 包含关键词输入框
- 包含搜索按钮
- 展示搜索结果区域
- **新增UI设计要求**:
  - 采用左右布局设计，左侧为导航栏，右侧为内容区域
  - 导航栏设计为模块化结构，支持添加、隐藏不同模块
  - 第一个导航模块为"搜索测试"，包含原首页功能
  - "管理"作为另一个导航模块，包含所有管理功能
  - 配置历史置于管理模块内，不单独列为导航项
  - 所有页面保持统一的视觉设计风格
  - 页面结构采用模块化设计，便于后续扩展

### 2. 搜索功能
- 接收用户输入的关键词
- 调用 @news 服务的 API
- 支持单个或多个关键词搜索

### 3. 结果展示
- 以 JSON 格式显示搜索结果
- 结果应包含从 @news 服务获取的完整信息
- 界面应美观易读

### 4. 系统功能
- 处理可能的搜索错误
- 提供友好的错误提示
- 支持基本的搜索结果加载状态显示

### 5. 用户体验增强
- 异步请求处理：在等待 @news 服务响应时，页面不应卡死
- 加载状态可视化：明确显示搜索请求的进行状态（加载中、完成、出错）
- 友好错误提示：针对不同类型的错误（网络问题、服务故障、参数错误等）提供具体的错误信息
- 操作反馈：对用户的每一步操作提供及时、明确的反馈
- 数据加载过渡动画：使用适当的动画效果减轻用户等待感

### 6. 多条内容处理
- 处理 data.content 数组中包含多条内容项的情况
- 提供分页控件用于浏览多条搜索结果
- 每条内容项应清晰区分，包含标题、创建时间和详细内容
- 支持内容项折叠/展开功能，默认仅显示标题和摘要
- 提供按时间排序和相关度排序的选项
- 对于特别长的内容，实现内容截断和"查看更多"功能

### 7. 管理员配置页面
- 提供专门的管理员配置界面，用于集中管理系统所有配置
- 支持基于角色的访问控制，仅管理员可访问
- 配置项设置：
  - API相关配置：@news服务的URL、超时时间、请求频率限制等
  - 搜索相关配置：默认每页结果数、最大关键词长度、默认排序方式等
  - 界面相关配置：主题颜色、字体大小、内容展示方式等
  - 缓存相关配置：缓存开关、缓存过期时间、最大缓存条数等
  - 性能相关配置：最大并发请求数、请求重试次数等
- 提供配置导入/导出功能，支持JSON格式
- 配置修改后实时生效，无需重启应用
- 配置历史记录功能，支持回退到之前的配置版本
- 用户反馈设置：配置是否收集用户反馈及反馈方式

## 已开发页面和功能

### 前端页面

#### 1. 首页布局设计
- **新设计**：
  - 左右分栏式布局，取代原居中设计
  - 左侧固定宽度导航栏，支持折叠/展开
  - 右侧为自适应宽度的内容区域
  - 响应式设计，在移动设备上自动调整布局
  - 导航栏支持自定义主题颜色
  - 支持模块化的导航项管理（添加/删除/隐藏）
  - 用户登录状态在导航栏顶部显示

#### 2. 导航模块组织
- **搜索测试模块**：
  - 关键词输入框与搜索按钮
  - 配置每页结果数（5/10/20/50）选项
  - 排序方式选择器
  - 搜索结果展示区域
  - 结果分页控件

- **管理模块**：
  - 包含所有原管理页面功能
  - 子导航结构，用于切换不同配置页面
  - 配置历史功能集成在管理模块内
  - 权限控制机制
  - 管理操作状态反馈

#### 3. 搜索结果页 (仍然保留，但集成到新UI)
- 顶部搜索栏，支持实时修改搜索词
- 搜索状态指示：加载中、结果计数、错误信息
- 卡片式搜索结果布局，响应式设计
- 结果展示包含：
  - 标题
  - 格式化发布时间
  - 内容预览（自动截断长内容）
  - "查看完整内容"按钮
- 点击结果卡片弹出完整内容模态框
- 关键词在结果中高亮显示
- 分页导航控件，支持大量结果浏览
- 开发者模式：可切换显示原始JSON响应

#### 4. 管理员界面
- 管理员登录页 (login.ejs)：安全的管理员身份验证
- 管理主页 (admin/index.ejs)：仪表盘布局的配置中心
- 侧边栏导航，快速访问各配置模块
- 统一的配置表单布局和验证机制

#### 5. 配置模块页面
- **API配置页面**：管理@news服务连接参数
  - API基础URL设置
  - API密钥和版本管理
  - 请求超时和重试设置
  - 请求频率限制
  - 压缩和指标收集选项

- **搜索配置页面**：搜索行为定制
  - 默认分页大小
  - 关键词长度限制
  - 默认排序方法
  - 内容截断长度
  - 高级搜索选项和过滤设置

- **UI配置页面**：界面定制
  - 主题和颜色设置
  - 字体大小和字体族选择
  - 内容展示模式（卡片/列表/表格）
  - 动画效果和过渡设置
  - 响应式文字大小和回到顶部按钮选项

- **缓存配置页面**：性能优化
  - 缓存状态监控（条目数/命中率/内存使用）
  - 基本缓存开关和过期时间
  - 高级缓存设置（淘汰策略/最大大小/压缩）
  - 缓存规则配置（搜索结果/计数结果/排除关键词）

- **性能配置页面**：系统性能调优
  - 实时性能监控（响应时间/成功率/并发请求/内存使用）
  - 请求处理设置（并发数/超时/连接池）
  - 资源优化（内存限制/垃圾回收/HTTP压缩）
  - 性能日志和监控配置

- **用户反馈配置页面**：反馈机制管理
  - 反馈功能启用开关
  - 数据收集设置（匿名数据/搜索数据/浏览器信息）
  - 表单定制（标题/描述/必填字段）
  - 通知设置（邮件通知/感谢邮件）

- **配置历史页面**：版本控制
  - 历史配置记录表格
  - 按配置类型筛选
  - 配置对比视图
  - 一键恢复历史配置

- **导入导出页面**：配置迁移
  - 选择性配置导出（单类型/全部）
  - 配置文件导入和预览
  - 导入选项（备份当前配置/完全覆盖）
  - 导入导出操作历史记录

### 核心功能实现

#### 1. 搜索功能
- AJAX异步搜索请求，不阻塞页面
- 支持URL参数保存搜索状态（关键词/页码/每页数量）
- 搜索状态可共享和书签收藏
- 历史导航支持（前进/后退）

#### 2. 结果处理
- 动态创建结果卡片，响应式布局自适应
- 标题和内容安全展示（XSS防护）
- 日期本地化格式化
- 内容智能截断和展开

#### 3. 分页实现
- 自适应分页控件（首页/末页/上一页/下一页/中间页）
- 智能显示当前页附近页码
- 页码点击无刷新加载
- 页面切换后自动滚动到顶部

#### 4. 管理界面架构
- 模块化配置页面设计
- 统一的表单验证机制
- 实时表单状态反馈
- AJAX配置提交，无需页面刷新
- 配置更改即时生效通知

#### 5. 配置历史管理
- 配置变更自动记录
- 差异对比可视化
- 回滚确认机制
- 筛选和分页浏览历史

#### 6. 配置导入导出
- JSON格式配置导出
- 选择性导出指定配置模块
- 导入预览和确认机制
- 导入前自动备份当前配置

#### 7. 错误处理
- 用户友好错误提示
- 网络错误智能识别
- API响应错误解析
- 表单验证错误反馈
- 配置操作错误处理

## 技术栈

### 前端技术
- HTML5 + CSS3：构建基础页面结构和样式
- JavaScript + jQuery：实现交互功能
- Bootstrap：提供响应式布局和现成的UI组件
- JSON Formatter：美化JSON输出结果

### 后端技术
- Node.js：轻量级的JavaScript运行环境
- Express.js：简单易用的Web应用框架
- Axios：处理HTTP请求

### 开发工具
- Visual Studio Code：代码编辑器
- Git：版本控制
- npm：包管理工具

## 外部依赖

### @news 服务 API
- **基础URL**: `/news/api`
- **返回格式**: JSON
- **字符编码**: UTF-8

#### 1. 搜索接口
- **URL**: `/news/api/search`
- **方法**: POST
- **功能**: 根据关键词进行新闻搜索，支持分页和高级搜索语法
- **请求参数**:
  - keywords (String, 必填): 搜索关键词，支持逗号分隔多个词和"OR"语法
  - page (Number, 可选): 页码，默认为1
  - size (Number, 可选): 每页数量，默认为10
- **响应格式**: 
  - 成功响应包含搜索结果数组，每条结果包含id、title、content(带高亮)、createTime等字段
  - 分页信息包含totalElements、page、size、totalPages等字段

#### 2. 计数接口
- **URL**: `/news/api/count`
- **方法**: GET
- **功能**: 根据关键词统计符合条件的新闻数量
- **请求参数**:
  - keywords (String, 必填): 搜索关键词
- **响应格式**:
  - 返回符合条件的文档数量

## 响应数据结构处理

### 1. 标准响应结构
```json
{
  "success": true,
  "message": "成功",
  "data": {
    "content": [
      {
        "name": "新闻标题1",
        "created": "2025-03-29T10:59:03.000+00:00",
        "content": "新闻内容1..."
      },
      {
        "name": "新闻标题2",
        "created": "2025-03-28T09:45:12.000+00:00",
        "content": "新闻内容2..."
      }
      // 更多内容项...
    ],
    "page": 0,
    "size": 10,
    "totalElements": 19,
    "totalPages": 2,
    "first": true,
    "last": false,
    "empty": false,
    "numberOfElements": 10
  }
}
```

### 2. 数据处理要点
- 检查 `success` 状态，确保请求成功
- 从 `data.content` 数组中提取多条内容项
- 处理分页信息，包括当前页码、总页数、是否为首页/末页等
- 对每条内容的 `created` 时间进行格式化，转换为本地时间格式
- 对 `content` 字段中可能存在的特殊字符或HTML标签进行适当处理
- 支持按 `created` 时间或相关度对结果进行排序

### 3. 内容显示策略
- 默认按页面大小 `size` 限制显示的内容条数
- 提供简单的前端分页控件，允许用户浏览所有 `totalPages` 页内容
- 实现前端缓存机制，减少重复请求
- 对特别长的 `content` 内容实现智能截断，避免页面过长

## 管理员配置界面

### 1. 访问控制
- 通过路径`/admin`访问管理界面
- 采用基本的用户名/密码认证机制
- 支持会话超时自动登出功能
- 实现简单的操作日志，记录配置变更

### 2. 配置项组织
- 按功能模块分类组织配置项
- 使用选项卡或折叠面板方式展示不同类别的配置
- 每个配置项提供描述信息和取值建议
- 关键配置项提供恢复默认值的选项

### 3. 配置存储
- 配置信息使用JSON格式存储于服务器端
- 修改后的配置立即生效并持久化保存
- 定期自动备份配置文件
- 支持手动导出和导入配置

### 4. 管理界面功能
- 配置搜索：快速查找特定配置项
- 批量修改：支持一次性应用多个配置更改
- 配置验证：提交前验证配置值的有效性
- 配置版本比较：查看不同版本之间的配置差异
- 配置依赖检查：识别并提示相互依赖的配置项

## 性能需求

- 响应时间：取决于 @news 服务的响应速度，本应用应在接收到 @news 服务响应后的 500ms 内完成处理和展示
- 并发用户数：支持约 200 个并发用户同时使用
- 资源占用：轻量级应用，最小化 CPU 和内存占用
- 操作体验：界面加载应在 2 秒内完成，搜索过程中提供明显的加载状态反馈

## 安全需求

- 输入验证：对用户输入的关键词进行验证，防止SQL注入攻击
- 特殊字符处理：过滤或转义特殊字符，确保搜索参数安全
- 输入长度限制：限制关键词长度，防止过长输入导致的潜在问题
- 管理界面安全：
  - 实现管理员账户密码复杂度要求
  - 管理界面访问需使用HTTPS连接
  - 管理操作需二次确认机制
  - 敏感配置项（如API密钥）需脱敏显示

## 项目里程碑

### 里程碑 1：基础界面实现（第 1 周）
- 搭建项目基本结构
- 实现简单的首页界面，包含关键词输入框和搜索按钮
- 完成基本的页面样式设计

### 里程碑 2：基础搜索功能实现（第 2 周）
- 实现与 @news 服务的基本连接
- 完成关键词搜索的核心功能
- 以简单方式展示 JSON 格式的搜索结果

### 里程碑 3：用户体验优化（第 3 周）
- 优化搜索结果的展示方式
- 添加加载状态指示器和过渡动画
- 实现详细的错误处理和友好提示
- 确保异步请求不会阻塞界面
- 实现多条内容的分页显示和排序功能

### 里程碑 4：功能完善与测试（第 4 周）
- 完善输入验证和特殊字符处理
- 优化应用性能
- 改进多条内容的展示方式和用户交互
- 进行全面测试和调整

### 里程碑 5：管理员界面实现（第 5 周）
- 设计和实现管理员登录页面
- 开发配置管理界面框架
- 实现各类配置项的编辑功能
- 添加配置导入/导出功能

### 里程碑 6：系统集成与完善（第 6 周）
- 将管理界面与主应用集成
- 实现配置实时生效功能
- 添加配置历史记录与回滚功能
- 完善安全措施和权限控制
- 进行系统全面测试

## 版本规划

### V0.1 - 原型版本
- 最基本的页面结构
- 简单的输入框和按钮
- 无实际功能，仅展示界面框架

### V0.2 - 基础功能版本
- 实现与 @news 服务的连接
- 支持基本的关键词搜索
- 以原始 JSON 格式展示结果

### V0.3 - 功能完善版本
- 优化用户界面
- 美化搜索结果展示
- 添加加载状态指示器和错误提示
- 实现异步请求处理，确保页面响应性
- 初步实现多条内容的分页浏览功能

### V0.4 - 管理功能版本
- 添加管理员登录入口
- 实现基本配置管理功能
- 提供简单的配置导出功能
- 基本的访问控制和安全措施

### V1.0 - 正式版本
- 完整的搜索功能
- 完善的安全措施
- 稳定的性能表现
- 良好的用户体验
- 详细的错误反馈系统
- 完善的多条内容处理和展示功能
- 全功能的管理员配置界面

## 项目风险

- @news 服务的可用性和稳定性
- 搜索结果的展示可能因数据量大而影响性能
- 用户输入的特殊字符可能导致搜索异常
- 异步处理和状态管理可能增加开发复杂度
- 大量内容的前端渲染可能导致页面响应迟缓
- 配置功能复杂度可能导致项目周期延长
- 管理界面安全风险需特别关注

## 更新历史

| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|----------|--------|
| 当前日期 | 0.1 | 初始需求文档创建 | System |
| 当前日期 | 0.2 | 添加项目概述和基本功能需求 | System |
| 当前日期 | 0.3 | 添加技术栈 | System |
| 当前日期 | 0.4 | 添加性能需求 | System |
| 当前日期 | 0.5 | 添加安全需求 | System |
| 当前日期 | 0.6 | 添加外部依赖 | System |
| 当前日期 | 0.7 | 添加项目里程碑和版本规划 | System |
| 当前日期 | 0.8 | 补充用户体验需求 | System |
| 当前日期 | 0.9 | 添加多条内容处理和响应数据结构章节 | System |
| 当前日期 | 1.0 | 添加管理员配置页面需求 | System |
| 当前日期 | 1.1 | 添加已开发页面和核心功能描述 | Developer |

## 技术实现要求

### 模块化设计
- 采用组件化开发方式，每个功能模块独立开发和维护
- 导航模块配置可通过JSON定义，支持动态加载
- 提供模块注册和卸载机制
- 支持模块之间的通信
- 模块权限控制系统

### 响应式布局
- 在不同屏幕尺寸下（桌面、平板、手机）提供良好的使用体验
- 小屏幕设备下导航自动转为弹出式菜单
- 内容区域根据屏幕宽度自动调整布局和字体大小
- 关键操作区域在各种设备上保持易用性

### 主题与样式
- 提供预设的多套配色方案
- 支持明暗模式切换
- 关键元素的视觉强调
- 统一的字体和图标系统
- 一致的交互反馈效果

### 交互体验
- 平滑的页面切换动画
- 加载状态的可视化反馈
- 操作的实时响应
- 直观的错误提示
- 便捷的导航路径

## 部署说明

### 1. 服务器配置
- 确保服务器环境满足项目需求
- 配置Node.js运行环境
- 安装必要的依赖包

### 2. 数据库配置
- 配置数据库连接
- 创建必要的表结构

### 3. 环境变量配置
- 设置必要的系统变量
- 配置API访问权限

### 4. 日志配置
- 配置日志记录机制
- 设置日志级别和输出路径

### 5. 安全配置
- 配置HTTPS连接
- 设置防火墙规则
- 配置访问控制列表

### 6. 性能优化
- 配置缓存机制
- 优化数据库查询性能
- 设置合理的并发请求数

### 7. 备份与恢复
- 配置定期备份机制
- 设置备份文件存储路径
- 配置备份文件恢复流程

### 8. 监控与报警
- 配置性能监控工具
- 设置报警阈值和通知机制
- 配置访问日志监控

### 9. 文档与支持
- 编写详细的部署文档
- 提供在线技术支持
- 配置问题反馈渠道

### 10. 版本控制
- 配置版本控制工具
- 设置代码提交和合并流程
- 配置发布流程和版本发布机制 