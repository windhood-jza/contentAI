# 新闻搜索服务 API 接口说明文档

## 简介

本文档详细说明新闻搜索服务的 API 接口，包括调用地址、请求方法、参数说明以及响应格式。该服务提供新闻全文检索、关键词高亮与评分功能。

## 基础信息

- **基础URL**: `/news/api`
- **返回格式**: JSON
- **字符编码**: UTF-8

## 通用响应格式

所有 API 的响应格式如下：

```json
{
  "success": true/false,  // 请求是否成功
  "message": "操作结果描述",  // 请求结果描述
  "data": {  // 响应数据，可能为对象、数组或简单值
    // 具体数据内容
  }
}
```

## 错误码说明

| 状态码 | 说明 |
| ----- | --- |
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 404 | 未找到资源 |
| 500 | 服务器内部错误 |
| 503 | 服务暂时不可用 |

## API 接口详情

### 1. 搜索接口

#### 请求信息

- **URL**: `/news/api/search`
- **方法**: POST
- **说明**: 根据关键词进行新闻搜索，支持分页和高级搜索语法

#### 请求参数

请求体采用 JSON 格式，参数如下：

| 参数名 | 类型 | 必填 | 说明 | 示例 |
| ----- | --- | --- | --- | --- |
| keywords | String | 是 | 搜索关键词，支持逗号分隔多个词；支持"OR"语法 | "政策,经济" |
| page | Number | 否 | 页码，默认为1 | 1 |
| size | Number | 否 | 每页数量，默认为10 | 10 |

#### 高级搜索语法

- **多关键词与搜索**: 使用逗号分隔，例如 "政策,经济"（表示同时包含"政策"和"经济"）
- **或关系搜索**: 使用 "OR" 连接，例如 "政策OR经济"（表示包含"政策"或"经济"）

#### 响应参数

| 参数名 | 类型 | 说明 |
| ----- | --- | --- |
| content | Array | 搜索结果数组 |
| content[].id | String | 文档ID |
| content[].title | String | 文档标题 |
| content[].content | String | 文档内容（可能包含HTML格式的高亮标记） |
| content[].createTime | Date | 文档创建时间 |
| totalElements | Number | 总结果数 |
| page | Number | 当前页码 |
| size | Number | 每页条数 |
| totalPages | Number | 总页数 |

#### 请求示例

```bash
curl -X POST \
  http://localhost:8080/news/api/search \
  -H 'Content-Type: application/json' \
  -d '{
    "keywords": "政策,经济",
    "page": 1,
    "size": 10
  }'
```

#### 响应示例

```json
{
  "success": true,
  "message": "搜索成功",
  "data": {
    "content": [
      {
        "id": "123456",
        "title": "国家发布新经济政策",
        "content": "近日，国家发布了新的<em>经济</em><em>政策</em>，促进...",
        "createTime": "2023-03-15T08:30:00.000Z"
      },
      {
        "id": "123457",
        "title": "地方政府响应经济政策",
        "content": "针对国家新出台的<em>经济</em><em>政策</em>，地方政府...",
        "createTime": "2023-03-16T10:20:00.000Z"
      }
    ],
    "totalElements": 42,
    "page": 1,
    "size": 10,
    "totalPages": 5
  }
}
```

### 2. 计数接口

#### 请求信息

- **URL**: `/news/api/count`
- **方法**: GET
- **说明**: 根据关键词统计符合条件的新闻数量

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
| ----- | --- | --- | --- | --- |
| keywords | String | 是 | 搜索关键词，支持逗号分隔多个词；支持"OR"语法 | "政策,经济" |

#### 响应参数

| 参数名 | 类型 | 说明 |
| ----- | --- | --- |
| data | Number | 符合条件的文档数量 |

#### 请求示例

```bash
curl -X GET 'http://localhost:8080/news/api/count?keywords=政策,经济'
```

#### 响应示例

```json
{
  "success": true,
  "message": "统计成功",
  "data": 42
}
```

## 错误响应示例

### 参数错误

```json
{
  "success": false,
  "message": "关键词不能为空",
  "data": null
}
```

### 服务不可用

```json
{
  "success": false,
  "message": "服务暂时不可用",
  "data": null
}
```

## 接口调用指南

### 搜索流程

1. 通过搜索接口提交搜索请求
2. 根据返回的分页信息，进行翻页操作
3. 显示结果时，可以直接展示高亮处理后的内容

### 最佳实践

- 搜索关键词建议使用精确词语，提高搜索精度
- 复杂搜索条件可以使用逻辑组合（逗号、OR）来实现
- 对于大数据量的搜索，建议合理控制每页条数，避免响应时间过长

## 示例代码

### JavaScript

```javascript
// 搜索请求示例
async function searchNews(keywords, page = 1, size = 10) {
  try {
    const response = await fetch('/news/api/search', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        keywords,
        page,
        size
      })
    });
    
    const result = await response.json();
    if (result.success) {
      return result.data;
    } else {
      console.error('搜索失败:', result.message);
      return null;
    }
  } catch (error) {
    console.error('请求异常:', error);
    return null;
  }
}

// 使用示例
searchNews('政策,经济')
  .then(data => {
    if (data) {
      console.log(`共找到 ${data.totalElements} 条结果`);
      data.content.forEach(item => {
        console.log(`${item.title} - ${new Date(item.createTime).toLocaleDateString()}`);
      });
    }
  });
```

### Java

```java
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

// 请求示例
public class SearchApiClient {
    private final RestTemplate restTemplate = new RestTemplate();
    private final String baseUrl = "http://localhost:8080/news/api";
    
    public SearchResult search(String keywords, int page, int size) {
        String url = baseUrl + "/search";
        
        SearchRequest request = new SearchRequest();
        request.setKeywords(keywords);
        request.setPage(page);
        request.setSize(size);
        
        ResponseEntity<ApiResponse> response = restTemplate.postForEntity(
                url, 
                request, 
                ApiResponse.class
        );
        
        ApiResponse apiResponse = response.getBody();
        if (apiResponse != null && apiResponse.isSuccess()) {
            return (SearchResult) apiResponse.getData();
        }
        
        return null;
    }
    
    public Integer count(String keywords) {
        String url = baseUrl + "/count?keywords=" + keywords;
        
        ResponseEntity<ApiResponse> response = restTemplate.getForEntity(
                url, 
                ApiResponse.class
        );
        
        ApiResponse apiResponse = response.getBody();
        if (apiResponse != null && apiResponse.isSuccess()) {
            return (Integer) apiResponse.getData();
        }
        
        return 0;
    }
}
``` 